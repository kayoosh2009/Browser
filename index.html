<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="–≠–ª–µ–≥–∞–Ω—Ç–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤–∏–∫ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —Ñ–æ–Ω–æ–º, —Ü–∏—Ç–∞—Ç–∞–º–∏ –∏ —Ç–µ–º–∞–º–∏" />
  <title>–≠–ª–µ–≥–∞–Ω—Ç–Ω—ã–π –ü–æ–∏—Å–∫–æ–≤–∏–∫</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-bg-opacity: 0.5;
      --search-bg-opacity: 0.1;
      --fab-bg-opacity: 0.2;
      --transition-duration: 0.3s;
      --bg-color: #000;
      --text-color: #fff;
      --search-bg: rgba(255, 255, 255, 0.2);
      --search-bg-hover: rgba(255, 255, 255, 0.3);
      --fab-bg: rgba(255, 255, 255, 0.2);
      --fab-bg-hover: rgba(255, 255, 255, 0.3);
      --modal-bg: rgba(0, 0, 0, 0.9);
      --toggle-bg-off: #555;
      --toggle-bg-on: #4caf50;
      --toggle-knob: #fff;
    }

    [data-theme="light"] {
      --bg-color: #f5f5f5;
      --text-color: #333;
      --search-bg: rgba(0, 0, 0, 0.1);
      --search-bg-hover: rgba(0, 0, 0, 0.2);
      --fab-bg: rgba(0, 0, 0, 0.2);
      --fab-bg-hover: rgba(0, 0, 0, 0.3);
      --modal-bg: rgba(255, 255, 255, 0.9);
      --toggle-bg-off: #ccc;
      --toggle-bg-on: #2196f3;
      --toggle-knob: #fff;
    }

    [data-contrast="high"] {
      --text-color: #fff;
      --bg-color: #000;
      --search-bg: #333;
      --search-bg-hover: #444;
      --fab-bg: #333;
      --fab-bg-hover: #444;
      --modal-bg: #222;
      --toggle-bg-off: #666;
      --toggle-bg-on: #fff;
      --toggle-knob: #000;
    }

    [data-power-saving="true"] {
      animation: none !important;
      transition: none !important;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —á–µ—Ä–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
    ::-webkit-scrollbar {
      width: 12px;
    }
    ::-webkit-scrollbar-track {
      background: #222;
    }
    ::-webkit-scrollbar-thumb {
      background: #000;
      border-radius: 6px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #333;
    }
    html {
      scrollbar-color: #000 #222;
      scrollbar-width: thin;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
    }

    body {
      background-color: var(--bg-color);
      background-size: cover;
      background-position: center;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      color: var(--text-color);
      transition: background-color var(--transition-duration), color var(--transition-duration);
    }

    body::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, var(--primary-bg-opacity));
      z-index: 0;
      transition: background var(--transition-duration);
    }

    .clock {
      font-size: 3.2rem;
      font-weight: 700;
      margin-bottom: 5px;
      z-index: 1;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .date {
      font-size: 1.2rem;
      color: var(--text-color);
      opacity: 0.8;
      margin-bottom: 10px;
      z-index: 1;
    }

    .quote {
      font-size: 0.65rem;
      color: var(--text-color);
      opacity: 0.8;
      margin-bottom: 15px;
      max-width: 30%;
      text-align: center;
      z-index: 1;
      line-height: 1.4;
      transition: opacity 1s ease-in-out;
      display: none;
    }

    .quote.active {
      display: block;
    }

    .quote.animate {
      opacity: 0;
      animation: fadeIn 1s ease-in-out forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 0.8; transform: translateY(0); }
    }

    .search-container {
      width: min(90%, 700px);
      backdrop-filter: blur(10px);
      background: var(--search-bg);
      border-radius: 25px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 1;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    .search-bar {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .search-bar input {
      flex: 1;
      padding: 15px 20px;
      border-radius: 50px;
      border: none;
      font-size: 1.2rem;
      background: var(--search-bg);
      color: var(--text-color);
      transition: background var(--transition-duration);
    }

    .search-bar input:focus {
      outline: none;
      background: var(--search-bg-hover);
    }

    .search-bar input::placeholder {
      color: var(--text-color);
      opacity: 0.7;
    }

    .engine-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      overflow: hidden;
      cursor: pointer;
      transition: transform var(--transition-duration);
    }

    .engine-icon:hover {
      transform: scale(1.1);
    }

    .engine-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity var(--transition-duration);
    }

    .engine-icon img.changing {
      opacity: 0;
    }

    .quick-links {
      display: none;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
      z-index: 1;
    }

    .quick-links.active {
      display: flex;
    }

    .quick-links a {
      padding: 8px 15px;
      background: var(--search-bg);
      border-radius: 20px;
      color: var(--text-color);
      text-decoration: none;
      font-size: 0.9rem;
      transition: background var(--transition-duration);
    }

    .quick-links a:hover {
      background: var(--search-bg-hover);
    }

    .weather-widget {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--search-bg);
      padding: 10px;
      border-radius: 10px;
      font-size: 0.9rem;
      z-index: 1;
      display: none;
      backdrop-filter: blur(5px);
    }

    .weather-widget.active {
      display: block;
    }

    .focus-timer {
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--search-bg);
      padding: 10px;
      border-radius: 10px;
      font-size: 0.9rem;
      z-index: 1;
      display: none;
      backdrop-filter: blur(5px);
    }

    .focus-timer.active {
      display: block;
    }

    .fab {
      position: fixed;
      right: 20px;
      bottom: 20px;
      display: flex;
      flex-direction: column-reverse;
      gap: 15px;
      z-index: 3;
    }

    .fab button {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: var(--fab-bg);
      color: var(--text-color);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      backdrop-filter: blur(5px);
      transition: transform var(--transition-duration), background var(--transition-duration);
    }

    .fab button:hover {
      transform: scale(1.1);
      background: var(--fab-bg-hover);
    }

    .settings-modal {
      position: fixed;
      right: 20px;
      bottom: 100px;
      background: var(--modal-bg);
      padding: 25px;
      border-radius: 12px;
      display: none;
      flex-direction: column;
      gap: 20px;
      z-index: 5;
      max-width: 320px;
      max-height: 80vh;
      overflow-y: auto;
      color: var(--text-color);
      transform: translateY(100%);
      transition: transform 0.3s ease-in-out;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .settings-modal.active {
      display: flex;
      transform: translateY(0);
    }

    .settings-modal label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 1rem;
      gap: 15px;
    }

    .settings-modal input[type="checkbox"] {
      display: none;
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 24px;
      background: var(--toggle-bg-off);
      border-radius: 12px;
      cursor: pointer;
      transition: background var(--transition-duration);
    }

    .toggle-switch::after {
      content: "";
      position: absolute;
      width: 20px;
      height: 20px;
      background: var(--toggle-knob);
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: transform var(--transition-duration);
    }

    input[type="checkbox"]:checked + .toggle-switch {
      background: var(--toggle-bg-on);
    }

    input[type="checkbox"]:checked + .toggle-switch::after {
      transform: translateX(26px);
    }

    .settings-modal input[type="range"] {
      cursor: pointer;
      width: 100%;
    }

    .settings-modal select,
    .settings-modal input[type="text"],
    .settings-modal input[type="url"] {
      padding: 8px;
      border-radius: 5px;
      background: var(--search-bg);
      color: var(--text-color);
      border: none;
      width: 100%;
      font-size: 0.9rem;
    }

    @media (max-width: 600px) {
      .clock {
        font-size: 2rem;
      }

      .date {
        font-size: 1rem;
      }

      .quote {
        max-width: 80%;
        font-size: 0.8rem;
      }

      .search-container {
        width: 95%;
        padding: 15px;
      }

      .search-bar input {
        font-size: 1rem;
        padding: 12px;
      }

      .settings-modal {
        right: 10px;
        bottom: 80px;
        max-width: 90%;
        padding: 15px;
      }

      .settings-modal label {
        font-size: 0.9rem;
      }

      .weather-widget,
      .focus-timer {
        top: 10px;
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="clock" id="clock" aria-live="polite">–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–º–µ–Ω–∏...</div>
  <div class="date" id="date" aria-live="polite">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç—ã...</div>
  <div class="quote" id="quote">–ó–∞–≥—Ä—É–∑–∫–∞ —Ü–∏—Ç–∞—Ç—ã...</div>

  <div class="search-container">
    <form class="search-bar" id="searchForm" role="search">
      <input 
        type="text" 
        id="searchInput" 
        placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..." 
        autocomplete="off" 
        aria-label="–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å"
      />
      <div 
        class="engine-icon" 
        id="engineCycle" 
        role="button" 
        aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É" 
        tabindex="0"
      >
        <img 
          id="engineIcon" 
          src="https://www.google.com/favicon.ico" 
          alt="–ò–∫–æ–Ω–∫–∞ —Ç–µ–∫—É—â–µ–π –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã" 
        />
      </div>
    </form>
    <div class="quick-links" id="quickLinks"></div>
  </div>

  <div class="weather-widget" id="weatherWidget">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–≥–æ–¥—ã...</div>
  <div class="focus-timer" id="focusTimer">–¢–∞–π–º–µ—Ä: 25:00</div>

  <div class="fab">
    <button id="settingsBtn" aria-label="–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
    <button id="wallpaperBtn" aria-label="–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ–Ω">üñºÔ∏è</button>
    <button id="themeBtn" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåó</button>
  </div>

  <div class="settings-modal" id="settingsModal" role="dialog" aria-labelledby="settingsTitle">
    <h2 id="settingsTitle" style="display: none;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
    <label>
      –û—Ç–∫—Ä—ã–≤–∞—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
      <input type="checkbox" id="openNewTab" checked aria-label="–û—Ç–∫—Ä—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ" />
      <span class="toggle-switch"></span>
    </label>
    <label>
      –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ü–∏—Ç–∞—Ç—ã
      <input type="checkbox" id="showQuotes" checked aria-label="–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ü–∏—Ç–∞—Ç—ã" />
      <span class="toggle-switch"></span>
    </label>
    <label>
      –Ø–∑—ã–∫ —Ü–∏—Ç–∞—Ç:
      <select id="quoteLanguage" aria-label="–í—ã–±–æ—Ä —è–∑—ã–∫–∞ —Ü–∏—Ç–∞—Ç">
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
      </select>
    </label>
    <label>
      –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ñ–æ–Ω–∞:
      <input 
        type="range" 
        id="bgOpacity" 
        min="0" 
        max="0.9" 
        step="0.1" 
        value="0.5" 
        aria-label="–†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ —Ñ–æ–Ω–∞"
      />
    </label>
    <label>
      –§–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏:
      <select id="timeFormat" aria-label="–í—ã–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏">
        <option value="24">24-—á–∞—Å–æ–≤–æ–π</option>
        <option value="12">12-—á–∞—Å–æ–≤–æ–π</option>
      </select>
    </label>
    <label>
      –°–≤–æ—è —Ü–∏—Ç–∞—Ç–∞:
      <input 
        type="text" 
        id="customQuote" 
        placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é —Ü–∏—Ç–∞—Ç—É..." 
        aria-label="–í–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Ü–∏—Ç–∞—Ç—ã"
      />
    </label>
    <label>
      –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É:
      <input 
        type="text" 
        id="linkName" 
        placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏..." 
        aria-label="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Å—ã–ª–∫–∏"
      />
      <input 
        type="url" 
        id="linkUrl" 
        placeholder="URL —Å—Å—ã–ª–∫–∏..." 
        aria-label="URL –Ω–æ–≤–æ–π —Å—Å—ã–ª–∫–∏"
      />
    </label>
    <label>
      –ê–≤—Ç–æ—Ñ–æ–Ω –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
      <input type="checkbox" id="autoBackground" aria-label="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ —Ñ–æ–Ω–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫" />
      <span class="toggle-switch"></span>
    </label>
    <label>
      –ê–Ω–∏–º–∞—Ü–∏—è —Ü–∏—Ç–∞—Ç—ã
      <input type="checkbox" id="quoteAnimation" checked aria-label="–í–∫–ª—é—á–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é —Ü–∏—Ç–∞—Ç—ã" />
      <span class="toggle-switch"></span>
    </label>
    <label>
      –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏
      <input type="checkbox" id="showQuickLinks" aria-label="–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –±—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏" />
      <span class="toggle-switch"></span>
    </label>
    <label>
      –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–≥–æ–¥—É
      <input type="checkbox" id="showWeather" aria-label="–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–≥–æ–¥—É" />
      <span class="toggle-switch"></span>
    </label>
    <label>
      –í—ã—Å–æ–∫–∞—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å
      <input type="checkbox" id="highContrast" aria-label="–†–µ–∂–∏–º –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç–∏" />
      <span class="toggle-switch"></span>
    </label>
    <label>
      –ê–≤—Ç–æ—Å–º–µ–Ω–∞ –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
      <input type="checkbox" id="autoEngine" aria-label="–ê–≤—Ç–æ—Å–º–µ–Ω–∞ –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã" />
      <span class="toggle-switch"></span>
    </label>
    <label>
      –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
      <input type="checkbox" id="saveSearch" aria-label="–°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å" />
      <span class="toggle-switch"></span>
    </label>
    <label>
      –¢–∞–π–º–µ—Ä —Ñ–æ–∫—É—Å–∞
      <input type="checkbox" id="focusTimer" aria-label="–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–∞–π–º–µ—Ä —Ñ–æ–∫—É—Å–∞" />
      <span class="toggle-switch"></span>
    </label>
    <label>
      –ó–≤—É–∫ –∫–ª–∏–∫–∞
      <input type="checkbox" id="clickSound" aria-label="–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ –∫–ª–∏–∫–∞" />
      <span class="toggle-switch"></span>
    </label>
    <label>
      –†–µ–∂–∏–º —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è
      <input type="checkbox" id="powerSaving" aria-label="–†–µ–∂–∏–º —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è" />
      <span class="toggle-switch"></span>
    </label>
  </div>

  <input type="file" id="bg-input" accept="image/jpeg,image/png,video/mp4,video/webm" style="display: none" />
  <audio id="clickSound" src="https://freesound.org/data/previews/612/612095_5674468-lq.mp3"></audio>

  <script>
    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —ç–ª–µ–º–µ–Ω—Ç—ã DOM
    const elements = {
      clock: document.getElementById("clock"),
      date: document.getElementById("date"),
      quote: document.getElementById("quote"),
      settingsBtn: document.getElementById("settingsBtn"),
      settingsModal: document.getElementById("settingsModal"),
      wallpaperBtn: document.getElementById("wallpaperBtn"),
      themeBtn: document.getElementById("themeBtn"),
      bgInput: document.getElementById("bg-input"),
      openNewTab: document.getElementById("openNewTab"),
      showQuotes: document.getElementById("showQuotes"),
      quoteLanguage: document.getElementById("quoteLanguage"),
      bgOpacity: document.getElementById("bgOpacity"),
      timeFormat: document.getElementById("timeFormat"),
      customQuote: document.getElementById("customQuote"),
      linkName: document.getElementById("linkName"),
      linkUrl: document.getElementById("linkUrl"),
      autoBackground: document.getElementById("autoBackground"),
      quoteAnimation: document.getElementById("quoteAnimation"),
      showQuickLinks: document.getElementById("showQuickLinks"),
      showWeather: document.getElementById("showWeather"),
      highContrast: document.getElementById("highContrast"),
      autoEngine: document.getElementById("autoEngine"),
      saveSearch: document.getElementById("saveSearch"),
      focusTimer: document.getElementById("focusTimer"),
      clickSound: document.getElementById("clickSound"),
      powerSaving: document.getElementById("powerSaving"),
      searchInput: document.getElementById("searchInput"),
      searchForm: document.getElementById("searchForm"),
      engineIcon: document.getElementById("engineIcon"),
      engineCycle: document.getElementById("engineCycle"),
      quickLinks: document.getElementById("quickLinks"),
      weatherWidget: document.getElementById("weatherWidget"),
      focusTimerDisplay: document.getElementById("focusTimer")
    };

    const engines = [
      { name: "Google", url: "https://www.google.com/search?q=", icon: "https://www.google.com/favicon.ico" },
      { name: "Bing", url: "https://www.bing.com/search?q=", icon: "https://www.bing.com/favicon.ico" },
      { name: "–Ø–Ω–¥–µ–∫—Å", url: "https://yandex.ru/search/?text=", icon: "https://yandex.ru/favicon.ico" },
      { name: "DuckDuckGo", url: "https://duckduckgo.com/?q=", icon: "https://duckduckgo.com/favicon.ico" }
    ];

    const quotes = {
      ru: [
        "–ú–µ—á—Ç–∞–π.", "–ë—É–¥—å —Å–æ–±–æ–π.", "–®–∞–Ω—Å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.", "–ú–µ–Ω—è–π—Å—è.", "–ù–∞—á–Ω–∏ —Å –º–∞–ª–æ–≥–æ.",
        "–ë—É–¥—å —Å–º–µ–ª—ã–º.", "–î–µ–π—Å—Ç–≤—É–π.", "–í–µ—Ä—å –≤ —Å–µ–±—è.", "–ù–∞—á–Ω–∏.", "–¢—ã –≤–∞–∂–µ–Ω."
      ],
      en: [
        "Dream big.", "Be yourself.", "Seize the day.", "Embrace change.", "Start small.",
        "Be brave.", "Take action.", "Believe in yourself.", "Begin now.", "You matter."
      ]
    };

    const defaultBackgrounds = {
      morning: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80",
      day: "https://images.unsplash.com/photo-1472214103451-9374bd1c798e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80",
      evening: "https://images.unsplash.com/photo-1503435980610-a51f3ddfee50?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80",
      night: "https://images.unsplash.com/photo-1475274047050-1d0c0975c63e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80"
    };

    const defaultLinks = [
      { name: "YouTube", url: "https://www.youtube.com" },
      { name: "ChatGPT", url: "https://chat.openai.com" },
      { name: "GitHub", url: "https://github.com" }
    ];

    let currentEngine = parseInt(getFromLocalStorage("engineIndex", 0)) || 0;
    let inactivityTimeout;
    let customQuotes = JSON.parse(getFromLocalStorage("customQuotes", "[]")) || [];
    let customLinks = JSON.parse(getFromLocalStorage("customLinks", JSON.stringify(defaultLinks))) || defaultLinks;
    let autoEngineInterval;
    let focusTimerInterval;
    let focusTime = 25 * 60; // 25 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

    // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage
    function getFromLocalStorage(key, defaultValue) {
      try {
        const value = localStorage.getItem(key);
        return value !== null ? JSON.parse(value) : defaultValue;
      } catch (e) {
        console.warn(`–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è ${key} –∏–∑ localStorage:`, e);
        return defaultValue;
      }
    }

    function setToLocalStorage(key, value) {
      try {
        localStorage.setItem(key, JSON.stringify(value));
      } catch (e) {
        console.warn(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ${key} –≤ localStorage:`, e);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏. –í–æ–∑–º–æ–∂–Ω–æ, localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ).");
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å–æ–≤ –∏ –¥–∞—Ç—ã
    function updateClockAndDate() {
      const now = new Date();
      const timeFormat = getFromLocalStorage("timeFormat", "24");
      elements.clock.textContent = now.toLocaleTimeString('ru-RU', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: timeFormat === "12"
      });
      elements.date.textContent = now.toLocaleDateString('ru-RU', {
        weekday: 'long',
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      });
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–∏—Ç–∞—Ç—ã
    function setQuote() {
      if (!elements.showQuotes.checked) {
        elements.quote.classList.remove("active");
        return;
      }
      const lang = getFromLocalStorage("quoteLanguage", "ru");
      const allQuotes = [...quotes[lang], ...customQuotes];
      elements.quote.textContent = allQuotes[Math.floor(Math.random() * allQuotes.length)] || "–¶–∏—Ç–∞—Ç–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞";
      elements.quote.classList.add("active");
      if (elements.quoteAnimation.checked) {
        elements.quote.classList.add("animate");
        setTimeout(() => elements.quote.classList.remove("animate"), 1000);
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±—ã—Å—Ç—Ä—ã—Ö —Å—Å—ã–ª–æ–∫
    function updateQuickLinks() {
      elements.quickLinks.innerHTML = "";
      customLinks.forEach(link => {
        const a = document.createElement("a");
        a.href = link.url;
        a.textContent = link.name;
        a.target = "_blank";
        a.rel = "noopener noreferrer";
        elements.quickLinks.appendChild(a);
      });
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
    async function updateWeather() {
      try {
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –ø–æ IP
        const geoResponse = await fetch("http://ip-api.com/json/");
        const geoData = await geoResponse.json();
        const { lat, lon, city } = geoData;

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
        const weatherResponse = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
        const weatherData = await weatherResponse.json();
        const temp = Math.round(weatherData.current_weather.temperature);
        const weatherCode = weatherData.current_weather.weathercode;
        const weatherDesc = {
          0: "—è—Å–Ω–æ", 1: "–ø–æ—á—Ç–∏ —è—Å–Ω–æ", 2: "–æ–±–ª–∞—á–Ω–æ", 3: "–ø–∞—Å–º—É—Ä–Ω–æ",
          45: "—Ç—É–º–∞–Ω", 51: "–º–æ—Ä–æ—Å—å", 61: "–¥–æ–∂–¥—å", 71: "—Å–Ω–µ–≥"
        }[weatherCode] || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";

        elements.weatherWidget.textContent = `${city}: ${temp}¬∞C, ${weatherDesc}`;
      } catch (e) {
        console.warn("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã:", e);
        elements.weatherWidget.textContent = "–ü–æ–≥–æ–¥–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞";
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
    function cycleEngine() {
      elements.engineIcon.classList.add("changing");
      currentEngine = (currentEngine + 1) % engines.length;
      setTimeout(() => {
        elements.engineIcon.src = engines[currentEngine].icon;
        elements.engineIcon.alt = `–ò–∫–æ–Ω–∫–∞ ${engines[currentEngine].name}`;
        elements.engineIcon.classList.remove("changing");
      }, 300);
      setToLocalStorage("engineIndex", currentEngine);
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Å–º–µ–Ω—ã –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
    function toggleAutoEngine() {
      if (elements.autoEngine.checked) {
        autoEngineInterval = setInterval(cycleEngine, 600000); // 10 –º–∏–Ω—É—Ç
      } else {
        clearInterval(autoEngineInterval);
      }
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–µ—Ä–∞ —Ñ–æ–∫—É—Å–∞
    function toggleFocusTimer() {
      if (elements.focusTimer.checked) {
        elements.focusTimerDisplay.classList.add("active");
        focusTime = 25 * 60;
        clearInterval(focusTimerInterval);
        focusTimerInterval = setInterval(() => {
          focusTime--;
          const minutes = Math.floor(focusTime / 60);
          const seconds = focusTime % 60;
          elements.focusTimerDisplay.textContent = `–¢–∞–π–º–µ—Ä: ${minutes}:${seconds.toString().padStart(2, "0")}`;
          if (focusTime <= 0) {
            clearInterval(focusTimerInterval);
            alert("–í—Ä–µ–º—è —Ñ–æ–∫—É—Å–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –û—Ç–¥–æ—Ö–Ω–∏—Ç–µ 5 –º–∏–Ω—É—Ç.");
            focusTime = 25 * 60;
            toggleFocusTimer();
          }
        }, 1000);
      } else {
        elements.focusTimerDisplay.classList.remove("active");
        clearInterval(focusTimerInterval);
      }
    }

    // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∫–ª–∏–∫–∞
    function playClickSound() {
      if (elements.clickSound.checked) {
        const audio = document.getElementById("clickSound");
        audio.currentTime = 0;
        audio.play().catch(e => console.warn("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:", e));
      }
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–µ–æ —Ñ–æ–Ω–∞
    function setupVideo(video, src) {
      video.src = src;
      video.play().catch((e) => console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤–∏–¥–µ–æ:", e));
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ —Ñ–æ–Ω–∞
    function updateAutoBackground() {
      if (!elements.autoBackground.checked) return;
      const hour = new Date().getHours();
      let period;
      if (hour >= 5 && hour < 12) period = "morning";
      else if (hour >= 12 && hour < 17) period = "day";
      else if (hour >= 17 && hour < 22) period = "evening";
      else period = "night";
      document.body.style.backgroundImage = `url(${defaultBackgrounds[period]})`;
      document.querySelector("#bg-video")?.remove();
      setToLocalStorage("wallpaper", defaultBackgrounds[period]);
      setToLocalStorage("wallpaperType", "image/jpeg");
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    function toggleTheme() {
      const currentTheme = document.body.dataset.theme === "light" ? "dark" : "light";
      document.body.dataset.theme = currentTheme;
      setToLocalStorage("theme", currentTheme);
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç–∏
    function toggleContrast() {
      document.body.dataset.contrast = elements.highContrast.checked ? "high" : "normal";
      setToLocalStorage("highContrast", elements.highContrast.checked);
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è
    function togglePowerSaving() {
      document.body.dataset.powerSaving = elements.powerSaving.checked ? "true" : "false";
      setToLocalStorage("powerSaving", elements.powerSaving.checked);
      if (elements.powerSaving.checked) {
        document.querySelector("#bg-video")?.remove();
        document.body.style.backgroundImage = "none";
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    async function initialize() {
      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
      elements.engineIcon.src = engines[currentEngine].icon;
      elements.engineIcon.alt = `–ò–∫–æ–Ω–∫–∞ ${engines[currentEngine].name}`;

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–º—ã
      const savedTheme = getFromLocalStorage("theme", window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
      document.body.dataset.theme = savedTheme;

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–∏—Ç–∞—Ç
      const showQuotes = getFromLocalStorage("showQuotes", true);
      elements.showQuotes.checked = showQuotes;
      const lang = getFromLocalStorage("quoteLanguage", "ru");
      elements.quoteLanguage.value = lang;
      setQuote();

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ —Ñ–æ–Ω–∞
      const opacity = getFromLocalStorage("bgOpacity", 0.5);
      document.documentElement.style.setProperty("--primary-bg-opacity", opacity);
      elements.bgOpacity.value = opacity;

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏
      const timeFormat = getFromLocalStorage("timeFormat", "24");
      elements.timeFormat.value = timeFormat;

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–∏—Ç–∞—Ç
      elements.customQuote.value = "";

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—ã—Å—Ç—Ä—ã—Ö —Å—Å—ã–ª–æ–∫
      const showLinks = getFromLocalStorage("showQuickLinks", false);
      elements.showQuickLinks.checked = showLinks;
      elements.quickLinks.classList.toggle("active", showLinks);
      updateQuickLinks();

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–≥–æ–¥—ã
      const showWeather = getFromLocalStorage("showWeather", false);
      elements.showWeather.checked = showWeather;
      elements.weatherWidget.classList.toggle("active", showWeather);
      if (showWeather) await updateWeather();

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ–Ω–∞
      const autoBg = getFromLocalStorage("autoBackground", false);
      elements.autoBackground.checked = autoBg;
      if (autoBg) updateAutoBackground();

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ —Ü–∏—Ç–∞—Ç
      const quoteAnim = getFromLocalStorage("quoteAnimation", true);
      elements.quoteAnimation.checked = quoteAnim;

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç–∏
      const highContrast = getFromLocalStorage("highContrast", false);
      elements.highContrast.checked = highContrast;
      toggleContrast();

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ—Å–º–µ–Ω—ã –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
      const autoEngine = getFromLocalStorage("autoEngine", false);
      elements.autoEngine.checked = autoEngine;
      toggleAutoEngine();

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
      const saveSearch = getFromLocalStorage("saveSearch", false);
      elements.saveSearch.checked = saveSearch;
      if (saveSearch) {
        elements.searchInput.value = getFromLocalStorage("searchQuery", "");
      }

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–∞ —Ñ–æ–∫—É—Å–∞
      const showTimer = getFromLocalStorage("focusTimer", false);
      elements.focusTimer.checked = showTimer;
      toggleFocusTimer();

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–≤—É–∫–∞ –∫–ª–∏–∫–∞
      const clickSound = getFromLocalStorage("clickSound", false);
      elements.clickSound.checked = clickSound;

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è
      const powerSaving = getFromLocalStorage("powerSaving", false);
      elements.powerSaving.checked = powerSaving;
      togglePowerSaving();

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
      const openNewTab = getFromLocalStorage("openNewTab", true);
      elements.openNewTab.checked = openNewTab;

      // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–∞
      const wp = getFromLocalStorage("wallpaper", null);
      const wpType = getFromLocalStorage("wallpaperType", null);
      if (wp && wpType && !autoBg && !powerSaving) {
        if (wpType.startsWith("video")) {
          const video = document.createElement("video");
          Object.assign(video, {
            id: "bg-video",
            autoplay: true,
            loop: true,
            muted: true,
            style: `
              position: fixed;
              inset: 0;
              width: 100%;
              height: 100%;
              object-fit: cover;
              z-index: -1;
            `
          });
          document.body.appendChild(video);
          setupVideo(video, wp);
        } else {
          document.body.style.backgroundImage = `url(${wp})`;
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Å–æ–≤ –∏ –¥–∞—Ç—ã
      updateClockAndDate();
      setInterval(updateClockAndDate, 1000);
      if (autoBg) setInterval(updateAutoBackground, 60000);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    function setupEventListeners() {
      elements.engineCycle.addEventListener("click", () => {
        playClickSound();
        cycleEngine();
      });
      elements.engineCycle.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          playClickSound();
          cycleEngine();
        }
      });

      elements.wallpaperBtn.addEventListener("click", () => {
        playClickSound();
        elements.bgInput.click();
      });

      elements.bgInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const validTypes = ["image/jpeg", "image/png", "video/mp4", "video/webm"];
        if (!validTypes.includes(file.type)) {
          alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG, PNG, MP4 –∏–ª–∏ WebM.");
          elements.bgInput.value = "";
          return;
        }

        const reader = new FileReader();
        reader.onload = () => {
          const base64Data = reader.result;
          elements.autoBackground.checked = false;
          setToLocalStorage("autoBackground", false);
          if (file.type.startsWith("video") && !elements.powerSaving.checked) {
            document.body.style.backgroundImage = "none";
            let video = document.querySelector("#bg-video");
            if (!video) {
              video = document.createElement("video");
              Object.assign(video, {
                id: "bg-video",
                autoplay: true,
                loop: true,
                muted: true,
                style: `
                  position: fixed;
                  inset: 0;
                  width: 100%;
                  height: 100%;
                  object-fit: cover;
                  z-index: -1;
                `
              });
              document.body.appendChild(video);
            }
            setupVideo(video, base64Data);
          } else {
            document.body.style.backgroundImage = `url(${base64Data})`;
            document.querySelector("#bg-video")?.remove();
          }
          setToLocalStorage("wallpaper", base64Data);
          setToLocalStorage("wallpaperType", file.type);
          elements.bgInput.value = "";
        };
        reader.readAsDataURL(file);
      });

      elements.settingsBtn.addEventListener("click", () => {
        playClickSound();
        elements.settingsModal.classList.toggle("active");
        if (elements.settingsModal.classList.contains("active")) {
          resetInactivityTimeout();
          elements.openNewTab.focus();
        } else {
          clearTimeout(inactivityTimeout);
        }
      });

      elements.themeBtn.addEventListener("click", () => {
        playClickSound();
        toggleTheme();
      });

      elements.openNewTab.addEventListener("change", (e) => {
        setToLocalStorage("openNewTab", e.target.checked);
      });

      elements.showQuotes.addEventListener("change", (e) => {
        setToLocalStorage("showQuotes", e.target.checked);
        setQuote();
      });

      elements.quoteLanguage.addEventListener("change", (e) => {
        setToLocalStorage("quoteLanguage", e.target.value);
        setQuote();
      });

      elements.bgOpacity.addEventListener("input", (e) => {
        document.documentElement.style.setProperty("--primary-bg-opacity", e.target.value);
        setToLocalStorage("bgOpacity", e.target.value);
      });

      elements.timeFormat.addEventListener("change", (e) => {
        setToLocalStorage("timeFormat", e.target.value);
        updateClockAndDate();
      });

      elements.customQuote.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && elements.customQuote.value.trim()) {
          customQuotes.push(elements.customQuote.value.trim());
          setToLocalStorage("customQuotes", customQuotes);
          setQuote();
          elements.customQuote.value = "";
        }
      });

      elements.linkName.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && elements.linkName.value.trim() && elements.linkUrl.value.trim()) {
          customLinks.push({ name: elements.linkName.value.trim(), url: elements.linkUrl.value.trim() });
          setToLocalStorage("customLinks", customLinks);
          updateQuickLinks();
          elements.linkName.value = "";
          elements.linkUrl.value = "";
        }
      });

      elements.linkUrl.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && elements.linkName.value.trim() && elements.linkUrl.value.trim()) {
          customLinks.push({ name: elements.linkName.value.trim(), url: elements.linkUrl.value.trim() });
          setToLocalStorage("customLinks", customLinks);
          updateQuickLinks();
          elements.linkName.value = "";
          elements.linkUrl.value = "";
        }
      });

      elements.autoBackground.addEventListener("change", (e) => {
        setToLocalStorage("autoBackground", e.target.checked);
        if (e.target.checked) updateAutoBackground();
      });

      elements.quoteAnimation.addEventListener("change", (e) => {
        setToLocalStorage("quoteAnimation", e.target.checked);
        setQuote();
      });

      elements.showQuickLinks.addEventListener("change", (e) => {
        setToLocalStorage("showQuickLinks", e.target.checked);
        elements.quickLinks.classList.toggle("active", e.target.checked);
      });

      elements.showWeather.addEventListener("change", async (e) => {
        setToLocalStorage("showWeather", e.target.checked);
        elements.weatherWidget.classList.toggle("active", e.target.checked);
        if (e.target.checked) await updateWeather();
      });

      elements.highContrast.addEventListener("change", (e) => {
        setToLocalStorage("highContrast", e.target.checked);
        toggleContrast();
      });

      elements.autoEngine.addEventListener("change", (e) => {
        setToLocalStorage("autoEngine", e.target.checked);
        toggleAutoEngine();
      });

      elements.saveSearch.addEventListener("change", (e) => {
        setToLocalStorage("saveSearch", e.target.checked);
        if (!e.target.checked) {
          setToLocalStorage("searchQuery", "");
          elements.searchInput.value = "";
        }
      });

      elements.searchInput.addEventListener("input", () => {
        if (elements.saveSearch.checked) {
          setToLocalStorage("searchQuery", elements.searchInput.value);
        }
      });

      elements.focusTimer.addEventListener("change", (e) => {
        setToLocalStorage("focusTimer", e.target.checked);
        toggleFocusTimer();
      });

      elements.clickSound.addEventListener("change", (e) => {
        setToLocalStorage("clickSound", e.target.checked);
      });

      elements.powerSaving.addEventListener("change", (e) => {
        setToLocalStorage("powerSaving", e.target.checked);
        togglePowerSaving();
      });

      elements.settingsModal.addEventListener("mousemove", resetInactivityTimeout);
      elements.settingsModal.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          elements.settingsModal.classList.remove("active");
          clearTimeout(inactivityTimeout);
        }
        resetInactivityTimeout();
      });

      elements.searchForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const query = elements.searchInput.value.trim();
        if (query) {
          const target = engines[currentEngine].url + encodeURIComponent(query);
          if (elements.openNewTab.checked) {
            window.open(target, "_blank", "noopener,noreferrer");
          } else {
            window.location.href = target;
          }
          if (!elements.saveSearch.checked) {
            elements.searchInput.value = "";
          }
        }
      });

      // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
      document.addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === "t") {
          e.preventDefault();
          playClickSound();
          cycleEngine();
        }
      });
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    function resetInactivityTimeout() {
      clearTimeout(inactivityTimeout);
      inactivityTimeout = setTimeout(() => {
        elements.settingsModal.classList.remove("active");
      }, 10000);
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    initialize();
    setupEventListeners();
  </script>
</body>
</html>
