<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Toko Apps</title>
  <link rel="icon" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><text x='50%' y='50%' font-size='50' dominant-baseline='middle' text-anchor='middle'>üí´</text></svg>">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #111;
      color: #fff;
      background-size: cover;
      background-position: center;
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: -1;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 2.5rem;
      font-weight: 600;
      margin-bottom: 30px;
      letter-spacing: 1px;
      opacity: 0.9;
    }
    .bookmark-grid {
      display: grid;
      grid-template-columns: repeat(7, 80px);
      gap: 20px;
      max-width: 700px;
      width: 100%;
      justify-content: center;
    }
    .circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s ease, opacity 0.3s ease, border 0.3s ease;
      cursor: pointer;
      backdrop-filter: blur(6px);
      border: 1.5px solid rgba(255, 255, 255, 0.2);
    }
    .circle:hover {
      transform: scale(1.1);
      opacity: 0.9;
      border-color: rgba(255, 255, 255, 0.4);
    }
    .plus-circle {
      background: rgba(30, 30, 30, 0.5);
      border: 2px dashed rgba(255, 255, 255, 0.3);
    }
    .bookmark-circle {
      background: rgba(30, 30, 30, 0.5);
      border: 1.5px solid rgba(255, 255, 255, 0.2);
    }
    .bookmark-circle img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.2));
    }
    .delete-mode .bookmark-circle {
      border: 2px solid rgba(239, 68, 68, 0.7);
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal.show {
      display: flex;
    }
    .modal-content {
      background: rgba(30, 30, 30, 0.5);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 20px;
      border-radius: 12px;
      max-width: 400px;
      width: 90%;
    }
    .modal-content h2 {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: #fff;
      opacity: 0.9;
    }
    .modal-content input {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.2);
      color: #fff;
      transition: background 0.3s, border 0.3s;
      backdrop-filter: blur(4px);
      margin-bottom: 15px;
    }
    .modal-content input:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.5);
    }
    .modal-content input::placeholder {
      color: #888;
    }
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    .modal-buttons button {
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s, border 0.3s;
    }
    .modal-buttons .cancel-btn {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #fff;
      opacity: 0.7;
    }
    .modal-buttons .cancel-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      opacity: 0.9;
    }
    .modal-buttons .save-btn {
      background: rgba(59, 130, 246, 0.7);
      border: none;
      color: #fff;
    }
    .modal-buttons .save-btn:hover {
      background: rgba(59, 130, 246, 0.9);
    }
    .bottom-buttons {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    .bottom-buttons button {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(30, 30, 30, 0.5);
      border: 1.5px solid rgba(255, 255, 255, 0.4);
      color: #fff;
      font-size: 22px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s, border-color 0.3s, transform 0.3s;
      backdrop-filter: blur(6px);
    }
    .bottom-buttons button:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.8);
      transform: rotate(10deg);
    }
    .trash-btn.active {
      background: rgba(248, 113, 113, 0.7);
      border-color: rgba(248, 113, 113, 0.9);
    }
    @media (max-width: 768px) {
      .bookmark-grid {
        grid-template-columns: repeat(7, 70px);
        gap: 15px;
      }
      .circle {
        width: 70px;
        height: 70px;
      }
      .bookmark-circle img {
        width: 35px;
        height: 35px;
      }
      h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="overlay" id="overlay"></div>
  <div class="container">
    <h1>Toko Apps</h1>
    <div id="bookmarkGrid" class="bookmark-grid">
      </div>
  </div>
  <div class="bottom-buttons">
    <button id="trashBtn" class="trash-btn" title="–†–µ–∂–∏–º —É–¥–∞–ª–µ–Ω–∏—è">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="white" viewBox="0 0 24 24">
        <path d="M3 6h18v2H3V6zm2 3h14v13a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V9zm5-2h4v2h-4V7z"/>
      </svg>
    </button>
    <button id="settingsBtn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="white" viewBox="0 0 24 24">
        <path d="M19.14 12.94a7.97 7.97 0 0 0 0-1.88l2.13-1.65a.5.5 0 0 0 .12-.64l-2-3.46a.5.5 0 0 0-.61-.22l-2.49 1a7.93 7.93 0 0 0-1.62-.94l-.38-2.65A.5.5 0 0 0 14.5 2h-4a.5.5 0 0 0-.49.42l-.38 2.65a7.93 7.93 0 0 0-1.62.94l-2.49-1a.5.5 0 0 0-.61.22l-2 3.46a.5.5 0 0 0 .12.64l2.13 1.65a7.97 7.97 0 0 0 0 1.88l-2.13 1.65a.5.5 0 0 0-.12.64l2 3.46a.5.5 0 0 0 .61.22l2.49-1a7.93 7.93 0 0 0 1.62.94l.38 2.65a.5.5 0 0 0 .49.42h4a.5.5 0 0 0 .49-.42l.38-2.65a7.93 7.93 0 0 0 1.62-.94l2.49 1a.5.5 0 0 0 .61-.22l2-3.46a.5.5 0 0 0-.12-.64l-2.13-1.65zM12 15.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7z"/>
      </svg>
    </button>
  </div>
  <div id="addModal" class="modal">
    <div class="modal-content">
      <h2>–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h2>
      <input
        type="url"
        id="siteUrl"
        placeholder="https://example.com"
        autocomplete="off"
      >
      <div class="modal-buttons">
        <button class="cancel-btn" onclick="closeAddModal()">–û—Ç–º–µ–Ω–∞</button>
        <button class="save-btn" onclick="saveBookmark()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <label for="rowCount" style="display: block; margin-bottom: 10px; opacity: 0.9;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫:</label>
      <input
        type="number"
        id="rowCount"
        min="1"
        max="10"
        value="4"
        style="width: 100px;"
      >
      <div class="modal-buttons">
        <button class="cancel-btn" onclick="closeSettingsModal()">–û—Ç–º–µ–Ω–∞</button>
        <button class="save-btn" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    let deleteMode = false;
    let currentCircleIndex = null;

    function openAddModal(index) {
      currentCircleIndex = index;
      document.getElementById('addModal').classList.add('show');
      document.getElementById('siteUrl').focus();
    }

    function closeAddModal() {
      document.getElementById('addModal').classList.remove('show');
      document.getElementById('siteUrl').value = '';
      currentCircleIndex = null;
    }

    function openSettingsModal() {
      const rowCount = localStorage.getItem('rowCount') || 4;
      document.getElementById('rowCount').value = rowCount;
      document.getElementById('settingsModal').classList.add('show');
    }

    function closeSettingsModal() {
      document.getElementById('settingsModal').classList.remove('show');
    }

    function saveBookmark() {
      let url = document.getElementById('siteUrl').value.trim();
      if (url) {
        if (!url.startsWith('http://') && !url.startsWith('https://')) {
          url = 'https://' + url;
        }
        const bookmarks = JSON.parse(localStorage.getItem('bookmarksJSON') || '[]');
        bookmarks[currentCircleIndex] = { url };
        localStorage.setItem('bookmarksJSON', JSON.stringify(bookmarks));
        closeAddModal();
        renderBookmarks();
      }
    }

    function saveSettings() {
      const rowCount = parseInt(document.getElementById('rowCount').value);
      if (rowCount >= 1 && rowCount <= 10) {
        localStorage.setItem('rowCount', rowCount);
        const bookmarks = JSON.parse(localStorage.getItem('bookmarksJSON') || '[]');
        const totalCells = rowCount * 7; // 7 cells per row
        if (bookmarks.length > totalCells) {
          bookmarks.splice(totalCells);
        } else if (bookmarks.length < totalCells) {
          bookmarks.push(...Array(totalCells - bookmarks.length).fill(null));
        }
        localStorage.setItem('bookmarksJSON', JSON.stringify(bookmarks));
        renderBookmarks();
        closeSettingsModal();
      }
    }

    function deleteBookmark(index) {
      if (deleteMode) {
        const bookmarks = JSON.parse(localStorage.getItem('bookmarksJSON') || '[]');
        bookmarks[index] = null;
        localStorage.setItem('bookmarksJSON', JSON.stringify(bookmarks));
        renderBookmarks();
      }
    }

    function toggleDeleteMode() {
      deleteMode = !deleteMode;
      const trashBtn = document.getElementById('trashBtn');
      trashBtn.classList.toggle('active');
      const grid = document.getElementById('bookmarkGrid');
      grid.classList.toggle('delete-mode');
    }

    function renderBookmarks() {
      const bookmarkGrid = document.getElementById('bookmarkGrid');
      let bookmarks = JSON.parse(localStorage.getItem('bookmarksJSON') || '[]');
      const rowCount = parseInt(localStorage.getItem('rowCount') || 5);
      const totalCells = rowCount * 7; // 7 cells per row
      if (bookmarks.length < totalCells) {
        bookmarks = bookmarks.concat(Array(totalCells - bookmarks.length).fill(null)); // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–¥–µ—Å—å
        localStorage.setItem('bookmarksJSON', JSON.stringify(bookmarks));
      } else if (bookmarks.length > totalCells) {
        bookmarks = bookmarks.slice(0, totalCells);
        localStorage.setItem('bookmarksJSON', JSON.stringify(bookmarks));
      }
      bookmarkGrid.style.gridTemplateRows = `repeat(${rowCount}, 80px)`;
      bookmarkGrid.innerHTML = '';

      bookmarks.forEach((bookmark, index) => {
        const cell = document.createElement('div');
        if (bookmark && bookmark.url) {
          cell.className = 'circle bookmark-circle';
          const favicon = `https://www.google.com/s2/favicons?domain=${bookmark.url}&sz=64`;
          cell.innerHTML = `<img src="${favicon}" alt="favicon" onerror="this.src='https://www.google.com/s2/favicons?domain=example.com'">`;
          cell.onclick = () => {
            if (deleteMode) {
              deleteBookmark(index);
            } else {
              window.open(bookmark.url, '_blank');
            }
          };
        } else {
          cell.className = 'circle plus-circle';
          cell.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="rgba(255,255,255,0.6)" viewBox="0 0 24 24"><path d="M12 5v14m7-7H5"/></svg>';
          cell.onclick = () => openAddModal(index);
        }
        bookmarkGrid.appendChild(cell);
      });
    }

    // Load background from localStorage
    const savedBg = localStorage.getItem('background');
    if (savedBg) {
      document.body.style.backgroundImage = `url(${savedBg})`;
    }

    document.getElementById('trashBtn').onclick = toggleDeleteMode;
    document.getElementById('settingsBtn').onclick = openSettingsModal;
    window.onload = renderBookmarks;
  </script>
</body>
</html>